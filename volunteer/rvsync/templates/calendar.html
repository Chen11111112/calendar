<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>è¡Œäº‹æ›†</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>
</head>

<body>
  <h1>æœˆæ›†</h1>
  <div id="calendar"></div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var calendarEl = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        events: '/api/events/',
        selectable: true,
        displayEventTime: false,
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },

        // æ–°å¢äº‹ä»¶
        dateClick: function(info) {
          let title = prompt("é€™å¤©è¦å¹¹å˜›å‘¢Ê• â€¢á´¥â€¢Ê”ï¼š");
          if (!title) return;

          let identity = prompt("ä½ æ˜¯èª°ï¼Ïˆ( Ì€âŒ„ Ì)Ïˆï¼ˆğŸ¦”=h / ğŸ¦•=t / å…©å€‹äºº=bï¼‰ï¼š", "h");
          if (!identity) identity = "both";

          fetch("/api/add_event/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              title: title,
              start: info.dateStr,
              end: info.dateStr,
              identity: identity   // âœ… å‚³åˆ°å¾Œç«¯
            })
          })
          .then(response => response.json())
          .then(event => {
            if (!event.error) {
              calendar.addEvent(event);
            }
          });
        },

        // åˆªé™¤äº‹ä»¶
        eventClick: function(info) {
          if (confirm(`è¦åˆªé™¤äº‹ä»¶ã€Œ${info.event.title}ã€å—ï¼Ÿ`)) {
            fetch(`/api/delete_event/${info.event.id}/`, {
              method: "POST",
              headers: { "Content-Type": "application/json" }
            })
            .then(response => response.json())
            .then(data => {
              if (data.status === "deleted") {
                info.event.remove();
              }
            });
          }
        },

        // é¡è‰²è¨­å®š
        eventDidMount: function(info) {
          let identity = info.event.extendedProps.identity;
          let dotEl = info.el.querySelector(".fc-daygrid-event-dot"); // æ‰¾åˆ°é»é»

          if (dotEl) {
            if (identity === "h") {
              dotEl.style.borderColor = "#0D5661";
            } else if (identity === "t") {
              dotEl.style.borderColor = "#CB4042";  
            } else {
              dotEl.style.borderColor = "#9E7A7A"; 
            }
          }
        }

      });
      calendar.render();
    });
  </script>


</body>
</html>
